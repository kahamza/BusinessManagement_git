# ğŸ¤– Telegram & n8n Integration

<div dir="rtl">

# ğŸ¤– ØªÙƒØ§Ù…Ù„ ØªÙ„ØºØ±Ø§Ù… Ùˆ n8n

</div>

## ğŸ“‹ Overview | Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©

The Telegram & n8n Integration enables seamless communication between your business management system and Telegram messaging platform using n8n as a middleware. This integration allows for real-time notifications, order processing, customer support, and automated workflows triggered by Telegram messages.

<div dir="rtl">

## ğŸ“‹ Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©

ÙŠØªÙŠØ­ ØªÙƒØ§Ù…Ù„ ØªÙ„ØºØ±Ø§Ù… Ùˆn8n Ø§ØªØµØ§Ù„Ø§Ù‹ Ø³Ù„Ø³Ù‹Ø§ Ø¨ÙŠÙ† Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø¹Ù…Ø§Ù„ Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ ÙˆÙ…Ù†ØµØ© Ù…Ø±Ø§Ø³Ù„Ø© ØªÙ„ØºØ±Ø§Ù… Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… n8n ÙƒÙˆØ³ÙŠØ·. ÙŠØªÙŠØ­ Ù‡Ø°Ø§ Ø§Ù„ØªÙƒØ§Ù…Ù„ Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ÙÙˆØ±ÙŠØ©ØŒ ÙˆÙ…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø·Ù„Ø¨Ø§ØªØŒ ÙˆØ¯Ø¹Ù… Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ØŒ ÙˆØ³ÙŠØ± Ø¹Ù…Ù„ Ø¢Ù„ÙŠ ÙŠØªÙ… ØªØ´ØºÙŠÙ„Ù‡ Ø¨Ø±Ø³Ø§Ø¦Ù„ ØªÙ„ØºØ±Ø§Ù….

</div>

## ğŸ¯ Key Features | Ø§Ù„Ù…ÙŠØ²Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©

### 1. Telegram Bot Integration
- **Bot Commands**: Custom commands for order tracking, inventory checks, and support
- **Inline Queries**: Quick access to product information and order status
- **Interactive Menus**: User-friendly interfaces with custom keyboards and buttons
- **File Handling**: Support for images, documents, and location sharing

### 2. n8n Workflow Automation
- **Event Triggers**: Respond to Telegram messages, commands, and callbacks
- **Data Processing**: Transform and validate incoming data
- **API Integration**: Connect with internal and external services
- **Conditional Logic**: Create complex workflows based on message content

### 3. Order Management
- **Order Placement**: Customers can place orders via Telegram
- **Order Status Updates**: Real-time order status notifications
- **Payment Processing**: Secure payment links and confirmations
- **Order History**: Access to past orders and receipts

### 4. Customer Support
- **Automated Responses**: Instant replies to common queries
- **Ticket System**: Create support tickets from messages
- **Agent Handoff**: Escalate complex issues to human agents
- **FAQ Integration**: Quick access to help articles

### 5. Notifications & Alerts
- **Stock Alerts**: Notify staff about low inventory
- **Order Confirmations**: Send order confirmations to customers
- **Appointment Reminders**: Automated reminders for bookings
- **Promotional Messages**: Targeted marketing campaigns

<div dir="rtl">

## ğŸ¯ Ø§Ù„Ù…ÙŠØ²Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©

### 1. ØªÙƒØ§Ù…Ù„ Ø¨ÙˆØª ØªÙ„ØºØ±Ø§Ù…
- **Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ø¨ÙˆØª**: Ø£ÙˆØ§Ù…Ø± Ù…Ø®ØµØµØ© Ù„ØªØªØ¨Ø¹ Ø§Ù„Ø·Ù„Ø¨Ø§Øª ÙˆØ§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ø®Ø²ÙˆÙ† ÙˆØ§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ
- **Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù…Ø§Øª Ø§Ù„Ù…Ø¶Ù…Ù†Ø©**: ÙˆØµÙˆÙ„ Ø³Ø±ÙŠØ¹ Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬ ÙˆØ­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨
- **Ù‚ÙˆØ§Ø¦Ù… ØªÙØ§Ø¹Ù„ÙŠØ©**: ÙˆØ§Ø¬Ù‡Ø§Øª Ø³Ù‡Ù„Ø© Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¨Ù„ÙˆØ­Ø§Øª Ù…ÙØ§ØªÙŠØ­ ÙˆØ£Ø²Ø±Ø§Ø± Ù…Ø®ØµØµØ©
- **Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…Ù„ÙØ§Øª**: Ø¯Ø¹Ù… Ø§Ù„ØµÙˆØ± ÙˆØ§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª ÙˆÙ…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ù…ÙˆÙ‚Ø¹

### 2. Ø£ØªÙ…ØªØ© Ø³ÙŠØ± Ø§Ù„Ø¹Ù…Ù„ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… n8n
- **Ù…Ø´ØºÙ„Ø§Øª Ø§Ù„Ø£Ø­Ø¯Ø§Ø«**: Ø§Ù„Ø±Ø¯ Ø¹Ù„Ù‰ Ø±Ø³Ø§Ø¦Ù„ ÙˆØ£ÙˆØ§Ù…Ø± ÙˆØ§Ø³ØªØ¯Ø¹Ø§Ø¡Ø§Øª ØªÙ„ØºØ±Ø§Ù…
- **Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª**: ØªØ­ÙˆÙŠÙ„ ÙˆØ§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙˆØ§Ø±Ø¯Ø©
- **ØªÙƒØ§Ù…Ù„ ÙˆØ§Ø¬Ù‡Ø§Øª Ø¨Ø±Ù…Ø¬Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª**: Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ© ÙˆØ§Ù„Ø®Ø§Ø±Ø¬ÙŠØ©
- **Ù…Ù†Ø·Ù‚ Ø´Ø±Ø·ÙŠ**: Ø¥Ù†Ø´Ø§Ø¡ Ø³ÙŠØ± Ø¹Ù…Ù„ Ù…Ø¹Ù‚Ø¯Ø© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø³Ø§Ù„Ø©

### 3. Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª
- **ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ø·Ù„Ø¨Ø§Øª**: ÙŠÙ…ÙƒÙ† Ù„Ù„Ø¹Ù…Ù„Ø§Ø¡ ØªÙ‚Ø¯ÙŠÙ… Ø·Ù„Ø¨Ø§Øª Ø¹Ø¨Ø± ØªÙ„ØºØ±Ø§Ù…
- **ØªØ­Ø¯ÙŠØ«Ø§Øª Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨**: Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ÙÙˆØ±ÙŠØ© Ø¨Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨
- **Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª**: Ø±ÙˆØ§Ø¨Ø· Ø¯ÙØ¹ Ø¢Ù…Ù†Ø© ÙˆØªØ£ÙƒÙŠØ¯Ø§Øª
- **Ø³Ø¬Ù„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª**: Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© ÙˆØ§Ù„ÙÙˆØ§ØªÙŠØ±

### 4. Ø¯Ø¹Ù… Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡
- **Ø±Ø¯ÙˆØ¯ ØªÙ„Ù‚Ø§Ø¦ÙŠØ©**: Ø±Ø¯ÙˆØ¯ ÙÙˆØ±ÙŠØ© Ø¹Ù„Ù‰ Ø§Ù„Ø§Ø³ØªÙØ³Ø§Ø±Ø§Øª Ø§Ù„Ø´Ø§Ø¦Ø¹Ø©
- **Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ°Ø§ÙƒØ±**: Ø¥Ù†Ø´Ø§Ø¡ ØªØ°Ø§ÙƒØ± Ø¯Ø¹Ù… Ù…Ù† Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
- **ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¹Ù…ÙŠÙ„**: ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù‚Ø¶Ø§ÙŠØ§ Ø§Ù„Ù…Ø¹Ù‚Ø¯Ø© Ø¥Ù„Ù‰ ÙˆÙƒÙ„Ø§Ø¡ Ø¨Ø´Ø±ÙŠÙŠÙ†
- **ØªÙƒØ§Ù…Ù„ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø´Ø§Ø¦Ø¹Ø©**: ÙˆØµÙˆÙ„ Ø³Ø±ÙŠØ¹ Ù„Ù…Ù‚Ø§Ù„Ø§Øª Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©

### 5. Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ÙˆØ§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª
- **ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„Ù…Ø®Ø²ÙˆÙ†**: Ø¥Ø®Ø·Ø§Ø± Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† Ø¨Ø§Ù†Ø®ÙØ§Ø¶ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
- **ØªØ£ÙƒÙŠØ¯Ø§Øª Ø§Ù„Ø·Ù„Ø¨Ø§Øª**: Ø¥Ø±Ø³Ø§Ù„ ØªØ£ÙƒÙŠØ¯Ø§Øª Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ù„Ù„Ø¹Ù…Ù„Ø§Ø¡
- **ØªØ°ÙƒÙŠØ±Ø§Øª Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯**: ØªØ°ÙƒÙŠØ±Ø§Øª Ø¢Ù„ÙŠØ© Ù„Ù„Ø­Ø¬ÙˆØ²Ø§Øª
- **Ø±Ø³Ø§Ø¦Ù„ ØªØ±ÙˆÙŠØ¬ÙŠØ©**: Ø­Ù…Ù„Ø§Øª ØªØ³ÙˆÙŠÙ‚ÙŠØ© Ù…Ø³ØªÙ‡Ø¯ÙØ©

</div>

## ğŸ—ï¸ Architecture | Ø§Ù„Ø¨Ù†ÙŠØ© Ø§Ù„Ù…Ø¹Ù…Ø§Ø±ÙŠØ©

### System Components
```mermaid
graph TD
    A[Telegram] -->|Webhook| B[n8n Server]
    B -->|API Calls| C[Business Management System]
    C -->|Data| B
    B -->|Send Messages| A
    
    subgraph Business Management System
        D[Orders]
        E[Inventory]
        F[Customers]
        G[Payments]
    end
    
    B <--> D
    B <--> E
    B <--> F
    B <--> G
```

### Data Flow
1. User sends a message/command to the Telegram bot
2. Telegram forwards the message to n8n via webhook
3. n8n processes the message and determines the appropriate action
4. n8n makes API calls to the Business Management System
5. System processes the request and returns data to n8n
6. n8n formats the response and sends it back to the user via Telegram

<div dir="rtl">

## ğŸ—ï¸ Ø§Ù„Ø¨Ù†ÙŠØ© Ø§Ù„Ù…Ø¹Ù…Ø§Ø±ÙŠØ©

### Ù…ÙƒÙˆÙ†Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…
```mermaid
graph TD
    A[ØªÙ„ØºØ±Ø§Ù…] -->|ÙˆÙŠØ¨ Ù‡ÙˆÙƒ| B[Ø®Ø§Ø¯Ù… n8n]
    B -->|Ø§Ø³ØªØ¯Ø¹Ø§Ø¡Ø§Øª API| C[Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø¹Ù…Ø§Ù„]
    C -->|Ø¨ÙŠØ§Ù†Ø§Øª| B
    B -->|Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ø¦Ù„| A
    
    subgraph Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø¹Ù…Ø§Ù„
        D[Ø§Ù„Ø·Ù„Ø¨Ø§Øª]
        E[Ø§Ù„Ù…Ø®Ø²ÙˆÙ†]
        F[Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡]
        G[Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª]
    end
    
    B <--> D
    B <--> E
    B <--> F
    B <--> G
```

### ØªØ¯ÙÙ‚ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
1. ÙŠØ±Ø³Ù„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø±Ø³Ø§Ù„Ø©/Ø£Ù…Ø±Ù‹Ø§ Ø¥Ù„Ù‰ Ø¨ÙˆØª ØªÙ„ØºØ±Ø§Ù…
2. ÙŠÙ‚ÙˆÙ… ØªÙ„ØºØ±Ø§Ù… Ø¨Ø¥Ø¹Ø§Ø¯Ø© ØªÙˆØ¬ÙŠÙ‡ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¥Ù„Ù‰ n8n Ø¹Ø¨Ø± ÙˆÙŠØ¨ Ù‡ÙˆÙƒ
3. ÙŠÙ‚ÙˆÙ… n8n Ø¨Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø±Ø³Ø§Ù„Ø© ÙˆØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨
4. ÙŠÙ‚ÙˆÙ… n8n Ø¨Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ø³ØªØ¯Ø¹Ø§Ø¡Ø§Øª API Ø¥Ù„Ù‰ Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø¹Ù…Ø§Ù„
5. ÙŠØ¹Ø§Ù„Ø¬ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø·Ù„Ø¨ ÙˆÙŠØ±Ø³Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ø¥Ù„Ù‰ n8n
6. ÙŠÙ‚ÙˆÙ… n8n Ø¨ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© ÙˆØ¥Ø±Ø³Ø§Ù„Ù‡Ø§ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¹Ø¨Ø± ØªÙ„ØºØ±Ø§Ù…

</div>

## ğŸ›  Implementation | Ø§Ù„ØªÙ†ÙÙŠØ°

### 1. Telegram Bot Setup

#### 1.1 Create a Telegram Bot
1. Open Telegram and search for `@BotFather`
2. Send `/newbot` and follow the instructions
3. Save the API token provided by BotFather
4. Enable webhook support with your n8n webhook URL

#### 1.2 Configure Bot Commands
```
/setcommands

help - Show help information
order - Place a new order
status - Check order status
support - Contact support
inventory - Check product availability
```

### 2. n8n Setup

#### 2.1 Install n8n
```bash
# Using npm
npm install n8n -g

# Using Docker
docker run -it --rm \
  --name n8n \
  -p 5678:5678 \
  -v ~/.n8n:/home/node/.n8n \
  n8nio/n8n
```

#### 2.2 Configure Environment Variables
```env
# Telegram
TELEGRAM_BOT_TOKEN=your_telegram_bot_token
TELEGRAM_WEBHOOK_URL=https://your-domain.com/webhook/telegram

# Business Management System
API_BASE_URL=https://api.your-business.com/v1
API_KEY=your_api_key

# Security
N8N_ENCRYPTION_KEY=your_encryption_key
WEBHOOK_URL=https://your-n8n-instance.com
```

### 3. Core Workflows

#### 3.1 Message Processing Workflow
```mermaid
graph TD
    A[Telegram Trigger] --> B[Extract Message]
    B --> C{Command?}
    C -->|Yes| D[Process Command]
    C -->|No| E[Process Natural Language]
    D --> F[Execute Command Logic]
    E --> G[Extract Intent]
    G --> H[Generate Response]
    F --> I[Send Response]
    H --> I
```

#### 3.2 Order Processing Workflow
```mermaid
graph TD
    A[Order Command] --> B[Extract Order Details]
    B --> C[Validate Order]
    C -->|Valid| D[Create Order in System]
    C -->|Invalid| E[Request Correction]
    D --> F[Send Order Confirmation]
    F --> G[Notify Staff]
```

### 4. Implementation Code

#### 4.1 Telegram Webhook Handler
```typescript
// n8n node script for handling Telegram webhooks
const { Telegram } = require('telegram-bot-api');

const bot = new Telegram({
    token: process.env.TELEGRAM_BOT_TOKEN,
    updates: { enabled: true }
});

// Handle incoming messages
bot.on('message', async (msg) => {
    const chatId = msg.chat.id;
    const text = msg.text || '';
    
    try {
        // Process command
        if (text.startsWith('/')) {
            const [command, ...args] = text.split(' ');
            await handleCommand(chatId, command, args, msg);
        } else {
            // Process natural language
            const response = await processNaturalLanguage(text, msg);
            await bot.sendMessage(chatId, response);
        }
    } catch (error) {
        console.error('Error processing message:', error);
        await bot.sendMessage(chatId, 'âŒ An error occurred. Please try again later.');
    }
});

// Handle commands
async function handleCommand(chatId, command, args, msg) {
    switch (command.toLowerCase()) {
        case '/start':
            await showWelcomeMessage(chatId, msg.from);
            break;
            
        case '/order':
            await startOrderProcess(chatId, msg.from);
            break;
            
        case '/status':
            await checkOrderStatus(chatId, args[0]);
            break;
            
        case '/help':
            await showHelp(chatId);
            break;
            
        default:
            await bot.sendMessage(chatId, 'âŒ Unknown command. Type /help for available commands.');
    }
}
```

#### 4.2 Order Processing
```typescript
// Order processing in n8n
async function createOrder(chatId, orderData) {
    try {
        // Validate order data
        const validation = validateOrder(orderData);
        if (!validation.valid) {
            return {
                success: false,
                message: `âŒ Validation failed: ${validation.error}`
            };
        }
        
        // Create order in the business system
        const orderResponse = await fetch(`${process.env.API_BASE_URL}/orders`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${process.env.API_KEY}`
            },
            body: JSON.stringify({
                ...orderData,
                source: 'telegram',
                metadata: { chatId }
            })
        });
        
        if (!orderResponse.ok) {
            throw new Error('Failed to create order');
        }
        
        const order = await orderResponse.json();
        
        // Send order confirmation
        await bot.sendMessage(chatId, formatOrderConfirmation(order));
        
        // Notify staff
        await notifyStaffAboutNewOrder(order);
        
        return {
            success: true,
            orderId: order.id,
            message: 'âœ… Order placed successfully!'
        };
    } catch (error) {
        console.error('Order creation error:', error);
        return {
            success: false,
            message: 'âŒ Failed to create order. Please try again later.'
        };
    }
}
```

#### 4.3 Natural Language Processing
```typescript
// Natural language processing with n8n
async function processNaturalLanguage(text, msg) {
    // Simple keyword matching (can be replaced with NLP service)
    const lowerText = text.toLowerCase();
    
    if (lowerText.includes('order status') || lowerText.includes('where is my order')) {
        return await handleOrderStatusQuery(msg);
    } 
    
    if (lowerText.includes('contact') || lowerText.includes('support')) {
        return await handleSupportRequest(msg);
    }
    
    if (lowerText.includes('price') || lowerText.includes('how much')) {
        return await handlePriceQuery(text);
    }
    
    // Default response
    return "I'm not sure how to help with that. Type /help for available commands.";
}

// Example: Handle order status query
async function handleOrderStatusQuery(msg) {
    // Extract order number from message or ask for it
    const orderNumber = extractOrderNumber(msg.text);
    
    if (!orderNumber) {
        return 'Please provide your order number so I can check the status for you.';
    }
    
    try {
        const response = await fetch(`${process.env.API_BASE_URL}/orders/${orderNumber}`, {
            headers: {
                'Authorization': `Bearer ${process.env.API_KEY}`
            }
        });
        
        if (!response.ok) {
            return 'âŒ Order not found. Please check the order number and try again.';
        }
        
        const order = await response.json();
        return formatOrderStatus(order);
    } catch (error) {
        console.error('Error fetching order status:', error);
        return 'âŒ Unable to fetch order status. Please try again later.';
    }
}
```

### 5. Security Considerations

#### 5.1 Webhook Security
```typescript
// Verify Telegram webhook secret
function verifyTelegramWebhook(req, res, next) {
    const secret = req.headers['x-telegram-bot-api-secret-token'];
    
    if (secret !== process.env.TELEGRAM_WEBHOOK_SECRET) {
        return res.status(401).send('Unauthorized');
    }
    
    next();
}

// Apply to all Telegram webhook routes
app.use('/webhook/telegram', verifyTelegramWebhook, telegramWebhookRouter);
```

#### 5.2 Rate Limiting
```typescript
const rateLimit = require('express-rate-limit');

const telegramLimiter = rateLimit({
    windowMs: 15 * 60 * 1000, // 15 minutes
    max: 100, // limit each IP to 100 requests per windowMs
    message: 'Too many requests from this IP, please try again later.'
});

app.use('/webhook/telegram', telegramLimiter);
```

## ğŸ§ª Testing | Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±

### 1. Unit Tests

```typescript
describe('Telegram Bot', () => {
    let bot;
    
    beforeAll(() => {
        // Mock Telegram API
        bot = {
            sendMessage: jest.fn(),
            on: jest.fn()
        };
        
        // Mock process.env
        process.env.TELEGRAM_BOT_TOKEN = 'test_token';
        process.env.API_BASE_URL = 'http://test-api.com';
    });
    
    test('should handle /start command', async () => {
        const mockMessage = {
            chat: { id: 12345 },
            from: { first_name: 'Test' },
            text: '/start'
        };
        
        await handleCommand(mockMessage);
        
        expect(bot.sendMessage).toHaveBeenCalledWith(
            12345,
            expect.stringContaining('Welcome')
        );
    });
    
    test('should validate order data', () => {
        const validOrder = {
            items: [{ id: 1, quantity: 2 }],
            customer: { name: 'Test', phone: '+1234567890' }
        };
        
        const invalidOrder = {
            items: [],
            customer: {}
        };
        
        expect(validateOrder(validOrder).valid).toBe(true);
        expect(validateOrder(invalidOrder).valid).toBe(false);
    });
});
```

### 2. Integration Tests

```typescript
describe('Order Processing', () => {
    let server;
    
    beforeAll(async () => {
        // Start test server
        server = await startTestServer();
    });
    
    afterAll(async () => {
        await server.close();
    });
    
    test('should create an order via Telegram', async () => {
        const orderData = {
            items: [{ id: 1, quantity: 2 }],
            customer: { name: 'Test', phone: '+1234567890' }
        };
        
        const response = await request(server)
            .post('/api/telegram/order')
            .send(orderData);
            
        expect(response.status).toBe(200);
        expect(response.body.success).toBe(true);
        expect(response.body.orderId).toBeDefined();
    });
});
```

## ğŸš€ Deployment | Ø§Ù„Ù†Ø´Ø±

### 1. Deployment Options

#### Option 1: Self-hosted n8n
1. Deploy n8n on your own server or cloud provider
2. Set up a reverse proxy (Nginx/Apache) with SSL
3. Configure environment variables
4. Set up PM2 or systemd for process management

#### Option 2: n8n.cloud
1. Sign up for n8n.cloud
2. Connect your GitHub/GitLab repository
3. Configure environment variables in the dashboard
4. Deploy your workflows

### 2. Monitoring and Logging

```bash
# Monitor n8n processes
pm2 monit

# View logs
pm2 logs n8n

# Set up log rotation
pm2 install pm2-logrotate
pm2 set pm2-logrotate:max_size 10M
pm2 set pm2-logrotate:retain 7
```

### 3. Backup and Recovery

```bash
# Backup n8n data
cp -r ~/.n8n ~/n8n-backup-$(date +%Y%m%d)

# Restore from backup
cp -r ~/n8n-backup-20230101/* ~/.n8n/
```

## ğŸ“ Conclusion | Ø§Ù„Ø®Ø§ØªÙ…Ø©

The Telegram & n8n integration provides a powerful way to extend your business management system with messaging capabilities. By following the architecture and implementation details in this document, you can create a robust and scalable solution for handling customer interactions, order processing, and notifications through Telegram.

<div dir="rtl">

## ğŸ“ Ø§Ù„Ø®Ø§ØªÙ…Ø©

ÙŠÙˆÙØ± ØªÙƒØ§Ù…Ù„ ØªÙ„ØºØ±Ø§Ù… Ùˆn8n Ø·Ø±ÙŠÙ‚Ø© Ù‚ÙˆÙŠØ© Ù„ØªÙ…ÙƒÙŠÙ† Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø¹Ù…Ø§Ù„ Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ Ù…Ù† Ø¥Ù…ÙƒØ§Ù†ÙŠØ§Øª Ø§Ù„Ù…Ø±Ø§Ø³Ù„Ø©. Ø¨Ø§ØªØ¨Ø§Ø¹ Ø§Ù„Ø¨Ù†ÙŠØ© Ø§Ù„Ù…Ø¹Ù…Ø§Ø±ÙŠØ© ÙˆØªÙØ§ØµÙŠÙ„ Ø§Ù„ØªÙ†ÙÙŠØ° Ø§Ù„ÙˆØ§Ø±Ø¯Ø© ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªÙ†Ø¯ØŒ ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ù†Ø´Ø§Ø¡ Ø­Ù„ Ù‚ÙˆÙŠ ÙˆÙ‚Ø§Ø¨Ù„ Ù„Ù„ØªØ·ÙˆÙŠØ± Ù„Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ ØªÙØ§Ø¹Ù„Ø§Øª Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ ÙˆÙ…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª ÙˆØ§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ù…Ù† Ø®Ù„Ø§Ù„ ØªÙ„ØºØ±Ø§Ù….

</div>

## ğŸ“š Related Documents | Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª Ø°Ø§Øª Ø§Ù„ØµÙ„Ø©

1. [API Documentation](../api/01-overview.md)
2. [Order Management](../features/01-pos.md)
3. [Customer Management](../features/03-customers.md)
4. [Notification System](../architecture/04-notifications.md)

## ğŸ™‹ Support | Ø§Ù„Ø¯Ø¹Ù…

For support, please contact our development team or open an issue in the repository.

<div dir="rtl">

## ğŸ™‹ Ø§Ù„Ø¯Ø¹Ù…

Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø¯Ø¹Ù…ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ ÙØ±ÙŠÙ‚ Ø§Ù„ØªØ·ÙˆÙŠØ± Ø£Ùˆ ÙØªØ­ Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹.

</div>
